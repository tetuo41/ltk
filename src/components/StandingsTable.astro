---
import type { StandingsEntry, Division } from '@/types';

export interface Props {
  standings: StandingsEntry[];
  division: Division;
  title?: string;
}

const { standings, division, title } = Astro.props;
const displayTitle = title || `${division}ÈÉ®ÈñÄ`;

// Function to get team color by team name
function getTeamColor(teamName: string): string {
  const teamColors: Record<string, string> = {
    'precision_diadem': 'var(--color-precision)',
    'domination_crown': 'var(--color-domination)', 
    'sorcery_tiara': 'var(--color-sorcery)',
    'resolve_regalia': 'var(--color-resolve)',
    'Precision Diadem': 'var(--color-precision)',
    'Domination Crown': 'var(--color-domination)',
    'Sorcery Tiara': 'var(--color-sorcery)',
    'Resolve Regalia': 'var(--color-resolve)'
  };
  
  return teamColors[teamName] || 'var(--color-primary)';
}

// Function to format win rate
function formatWinRate(winRate: number): string {
  return Math.round(winRate * 100) + '%';
}

// Function to get rank indicator
function getRankIndicator(rank: number): string {
  const indicators = ['ü•á', 'ü•à', 'ü•â'];
  return indicators[rank - 1] || `${rank}‰Ωç`;
}
---

<div class="standings-table-container" data-division={division.toLowerCase()}>
  <header class="table-header">
    <h3 class="table-title">
      <span class="division-icon">
        {division === 'CORE' ? '‚öîÔ∏è' : 'üåü'}
      </span>
      {displayTitle}
    </h3>
    <div class="table-meta">
      <span class="team-count">{standings.length}„ÉÅ„Éº„É†</span>
    </div>
  </header>

  <div class="table-wrapper">
    <table class="standings-table" role="table" aria-label={`${displayTitle}„ÅÆÈ†Ü‰ΩçË°®`}>
      <thead>
        <tr>
          <th scope="col" class="rank-header">È†Ü‰Ωç</th>
          <th scope="col" class="team-header">„ÉÅ„Éº„É†</th>
          <th scope="col" class="wins-header" title="ÂãùÂà©Êï∞">Âãù</th>
          <th scope="col" class="losses-header" title="ÊïóÂåóÊï∞">Êïó</th>
          <th scope="col" class="winrate-header" title="ÂãùÁéá">ÂãùÁéá</th>
          <th scope="col" class="points-header" title="„Éù„Ç§„É≥„Éà">P</th>
        </tr>
      </thead>
      <tbody>
        {standings.map((entry, index) => (
          <tr 
            class={`standings-row ${index === 0 ? 'first-place' : ''}`}
            style={`--team-color: ${getTeamColor(entry.team)}`}
          >
            <td class="rank-cell">
              <span class="rank-indicator" aria-label={`${entry.rank}‰Ωç`}>
                {getRankIndicator(entry.rank)}
              </span>
              <span class="rank-number">{entry.rank}</span>
            </td>
            
            <td class="team-cell">
              <div class="team-info">
                <span class="team-name">{entry.team}</span>
                <span class="team-indicator" style={`background-color: ${getTeamColor(entry.team)}`}></span>
              </div>
            </td>
            
            <td class="wins-cell">
              <span class="stat-value wins">{entry.wins}</span>
            </td>
            
            <td class="losses-cell">
              <span class="stat-value losses">{entry.losses}</span>
            </td>
            
            <td class="winrate-cell">
              <div class="winrate-container">
                <span class="winrate-text">{formatWinRate(entry.win_rate)}</span>
                <div class="winrate-bar">
                  <div 
                    class="winrate-fill" 
                    style={`width: ${entry.win_rate * 100}%`}
                  ></div>
                </div>
              </div>
            </td>
            
            <td class="points-cell">
              <span class="stat-value points">{entry.points}</span>
            </td>
          </tr>
        ))}
      </tbody>
    </table>
  </div>

  <footer class="table-footer">
    <div class="legend">
      <div class="legend-item">
        <span class="legend-icon wins">Âãù</span>
        <span class="legend-text">ÂãùÂà©Êï∞</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon losses">Êïó</span>
        <span class="legend-text">ÊïóÂåóÊï∞</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon points">P</span>
        <span class="legend-text">„Éù„Ç§„É≥„Éà</span>
      </div>
    </div>
  </footer>
</div>

<style>
  .standings-table-container {
    background: rgba(12, 22, 44, 0.9);
    border-radius: var(--radius-xl);
    overflow: hidden;
    border: 2px solid var(--color-primary);
    transition: all var(--transition-normal);
  }

  .standings-table-container:hover {
    box-shadow: var(--shadow-lg);
    transform: translateY(-2px);
  }

  .table-header {
    background: linear-gradient(135deg, var(--color-primary), rgba(200, 155, 60, 0.8));
    color: var(--color-surface-dark);
    padding: var(--space-4) var(--space-6);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .table-title {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--font-size-xl);
    font-weight: 600;
    margin: 0;
  }

  .division-icon {
    font-size: var(--font-size-lg);
  }

  .table-meta {
    display: flex;
    align-items: center;
    gap: var(--space-3);
  }

  .team-count {
    font-size: var(--font-size-sm);
    background: rgba(12, 22, 44, 0.3);
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius-sm);
  }

  .table-wrapper {
    overflow-x: auto;
  }

  .standings-table {
    width: 100%;
    border-collapse: collapse;
    font-size: var(--font-size-sm);
  }

  thead th {
    background: rgba(70, 55, 20, 0.8);
    color: var(--color-text-light);
    padding: var(--space-4) var(--space-3);
    text-align: center;
    font-weight: 600;
    border-bottom: 2px solid var(--color-border);
    white-space: nowrap;
    position: sticky;
    top: 0;
    z-index: 10;
  }

  .rank-header {
    width: 80px;
  }

  .team-header {
    width: auto;
    text-align: left;
    padding-left: var(--space-4);
  }

  .wins-header,
  .losses-header,
  .points-header {
    width: 60px;
  }

  .winrate-header {
    width: 100px;
  }

  tbody tr {
    transition: all var(--transition-fast);
    position: relative;
  }

  tbody tr:hover {
    background: rgba(200, 155, 60, 0.1);
    transform: scale(1.02);
  }

  tbody tr:not(:last-child) {
    border-bottom: 1px solid rgba(70, 55, 20, 0.3);
  }

  .first-place {
    background: rgba(200, 155, 60, 0.1);
    border-left: 4px solid var(--color-primary);
  }

  .first-place::before {
    content: 'üëë';
    position: absolute;
    left: -2px;
    top: 50%;
    transform: translateY(-50%);
    font-size: var(--font-size-sm);
  }

  td {
    padding: var(--space-3) var(--space-3);
    text-align: center;
    vertical-align: middle;
  }

  .rank-cell {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
  }

  .rank-indicator {
    font-size: var(--font-size-lg);
  }

  .rank-number {
    font-weight: 600;
    color: var(--color-text-light);
    font-size: var(--font-size-sm);
  }

  .team-cell {
    text-align: left;
    padding-left: var(--space-4);
  }

  .team-info {
    display: flex;
    align-items: center;
    gap: var(--space-2);
  }

  .team-name {
    font-weight: 500;
    color: var(--color-text-light);
  }

  .team-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .stat-value {
    font-weight: 600;
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius-sm);
    display: inline-block;
    min-width: 24px;
  }

  .wins {
    color: var(--color-success);
    background: rgba(39, 174, 96, 0.1);
  }

  .losses {
    color: var(--color-error);
    background: rgba(231, 76, 60, 0.1);
  }

  .points {
    color: var(--color-primary);
    background: rgba(200, 155, 60, 0.1);
  }

  .winrate-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-1);
  }

  .winrate-text {
    font-weight: 600;
    color: var(--color-text-light);
    font-size: var(--font-size-sm);
  }

  .winrate-bar {
    width: 60px;
    height: 4px;
    background: rgba(70, 55, 20, 0.5);
    border-radius: var(--radius-sm);
    overflow: hidden;
  }

  .winrate-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--color-success), var(--color-primary));
    transition: width var(--transition-normal);
  }

  .table-footer {
    background: rgba(70, 55, 20, 0.3);
    padding: var(--space-3) var(--space-6);
    border-top: 1px solid var(--color-border);
  }

  .legend {
    display: flex;
    justify-content: center;
    gap: var(--space-6);
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: var(--space-2);
  }

  .legend-icon {
    width: 20px;
    height: 20px;
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--font-size-xs);
    font-weight: 600;
  }

  .legend-icon.wins {
    background: rgba(39, 174, 96, 0.2);
    color: var(--color-success);
  }

  .legend-icon.losses {
    background: rgba(231, 76, 60, 0.2);
    color: var(--color-error);
  }

  .legend-icon.points {
    background: rgba(200, 155, 60, 0.2);
    color: var(--color-primary);
  }

  .legend-text {
    font-size: var(--font-size-xs);
    color: var(--color-text-secondary);
  }

  /* Division-specific styling */
  .standings-table-container[data-division="core"] .table-header {
    background: linear-gradient(135deg, var(--color-error), rgba(231, 76, 60, 0.8));
  }

  .standings-table-container[data-division="next"] .table-header {
    background: linear-gradient(135deg, var(--color-accent), rgba(5, 150, 170, 0.8));
  }

  /* Responsive design */
  @media (max-width: 768px) {
    .table-header {
      padding: var(--space-3) var(--space-4);
      flex-direction: column;
      gap: var(--space-2);
      text-align: center;
    }

    .table-title {
      font-size: var(--font-size-lg);
    }

    .standings-table {
      font-size: var(--font-size-xs);
    }

    thead th {
      padding: var(--space-2);
    }

    td {
      padding: var(--space-2);
    }

    .team-cell {
      padding-left: var(--space-2);
    }

    .winrate-bar {
      width: 40px;
    }

    .legend {
      gap: var(--space-4);
    }
  }

  @media (max-width: 480px) {
    .table-header {
      padding: var(--space-2) var(--space-3);
    }

    .standings-table {
      font-size: 10px;
    }

    .rank-cell {
      flex-direction: column;
      gap: 2px;
    }

    .team-info {
      flex-direction: column;
      align-items: flex-start;
      gap: var(--space-1);
    }

    .legend {
      flex-direction: column;
      gap: var(--space-2);
    }

    .table-footer {
      padding: var(--space-2) var(--space-3);
    }
  }
</style>