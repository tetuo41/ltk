---
import Layout from '@/layouts/Layout.astro';
import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';
import PlayerStatsTable from '@/components/PlayerStatsTable.astro';
import TeamPerformanceChart from '@/components/TeamPerformanceChart.astro';
import ChampionAnalytics from '@/components/ChampionAnalytics.astro';
import MatchInsightsPanel from '@/components/MatchInsightsPanel.astro';

import type { DetailedMatchStats } from '@/types/statistics';

// Import detailed statistics data
import detailedStatsRaw from '@/data/detailed-match-stats.json';
const detailedStats = detailedStatsRaw as DetailedMatchStats;

// SEO meta data
const pageTitle = `LTK 2025 çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ - k4sen League of Legendså¤§ä¼š | é¸æ‰‹æˆç¸¾ãƒ»ãƒãƒ¼ãƒ åˆ†æãƒ»ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³çµ±è¨ˆ`;
const pageDescription = `k4senä¸»å‚¬LTK 2025ã®åŒ…æ‹¬çš„çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€‚${detailedStats.season_overview.total_matches}è©¦åˆãƒ»${detailedStats.season_overview.total_players}é¸æ‰‹ãƒ»${detailedStats.season_overview.unique_champions_played}ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³ã®è©³ç´°åˆ†æã€‚KDAã€ãƒ€ãƒ¡ãƒ¼ã‚¸ã€å‹ç‡ã€ãƒ”ãƒƒã‚¯ç‡ã€ãƒãƒ³ç‡ãªã©å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å…¬é–‹ä¸­ã€‚`;
const pageKeywords = [
  'LTK',
  'League The k4sen',
  'çµ±è¨ˆ',
  'statistics',
  'é¸æ‰‹æˆç¸¾',
  'player stats',
  'ãƒãƒ¼ãƒ åˆ†æ',
  'team analysis',
  'KDA',
  'ãƒ€ãƒ¡ãƒ¼ã‚¸',
  'damage',
  'ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³',
  'champion',
  'ãƒ”ãƒƒã‚¯ç‡',
  'pick rate',
  'ãƒãƒ³ç‡',
  'ban rate',
  'å‹ç‡',
  'win rate',
  'League of Legends',
  'LoL',
  'esports',
  'eã‚¹ãƒãƒ¼ãƒ„',
  'å¤§ä¼šãƒ‡ãƒ¼ã‚¿',
  'tournament data'
];

// Structured data for statistics page
const statisticsStructuredData = {
  "@context": "https://schema.org",
  "@type": "Dataset",
  "name": "LTK 2025 Tournament Statistics - è©³ç´°çµ±è¨ˆãƒ‡ãƒ¼ã‚¿",
  "description": `League The k4sen (LTK) 2025ã®åŒ…æ‹¬çš„ãªçµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã€‚${detailedStats.season_overview.total_matches}è©¦åˆã€${detailedStats.season_overview.total_players}é¸æ‰‹ã€${detailedStats.season_overview.unique_champions_played}ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³ã®è©³ç´°åˆ†æãƒ‡ãƒ¼ã‚¿ã€‚`,
  "url": "https://ltk-sbb.shiai.games/statistics",
  "keywords": pageKeywords.join(", "),
  "creator": {
    "@type": "Organization",
    "name": "LTK Development Team",
    "url": "https://ltk-sbb.shiai.games"
  },
  "publisher": {
    "@type": "Person",
    "name": "k4sen",
    "url": "https://twitter.com/thek4sen"
  },
  "dateCreated": "2025-07-31",
  "dateModified": new Date().toISOString().split('T')[0],
  "license": "https://creativecommons.org/licenses/by-nc/4.0/",
  "about": {
    "@type": "SportsEvent",
    "name": "League The k4sen 2025 - ç²¾éœŠã®èŠ±ç¥­ã‚Š å¹½æ˜ã®å¢ƒ",
    "sport": "League of Legends"
  },
  "distribution": {
    "@type": "DataDownload",
    "contentUrl": "https://ltk-sbb.shiai.games/statistics",
    "encodingFormat": "text/html"
  },
  "variableMeasured": [
    {
      "@type": "PropertyValue",
      "name": "Player Statistics",
      "description": "Individual player performance metrics including KDA, damage, win rates"
    },
    {
      "@type": "PropertyValue", 
      "name": "Team Performance",
      "description": "Team-level statistics and comparative analysis"
    },
    {
      "@type": "PropertyValue",
      "name": "Champion Analytics", 
      "description": "Champion pick/ban rates, win rates, and meta analysis"
    },
    {
      "@type": "PropertyValue",
      "name": "Match Insights",
      "description": "Detailed match analysis and key moments"
    }
  ]
};
---

<Layout 
  title={pageTitle}
  description={pageDescription}
  keywords={pageKeywords}
>
  <!-- Statistics Dataset Structured Data -->
  <script type="application/ld+json" set:html={JSON.stringify(statisticsStructuredData)}></script>
  <Header />
  
  <main class="pt-20">
    <!-- Hero Section -->
    <section class="py-16 bg-gradient-to-br from-primary to-secondary">
      <div class="max-w-6xl mx-auto px-5 text-center">
        <!-- Back Link -->
        <div class="mb-6">
          <a 
            href="/" 
            class="inline-flex items-center gap-2 px-4 py-2 bg-surface border border-tertiary rounded-lg text-dark-light hover:text-silver hover:border-accent transition-all duration-300"
          >
            â† ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹
          </a>
        </div>
        
        <h1 class="text-4xl md:text-6xl font-bold text-dark mb-4 leading-tight font-display">
          è©³ç´°çµ±è¨ˆãƒ‡ãƒ¼ã‚¿
        </h1>
        <p class="text-xl text-dark-light mb-6 font-medium">
          LTK 2025 Tournament Statistics & Analysis
        </p>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 max-w-4xl mx-auto">
          <div class="bg-surface border border-tertiary rounded-lg p-4 text-center">
            <span class="block text-3xl font-bold text-accent mb-1">{detailedStats.season_overview.total_matches}</span>
            <span class="text-sm text-dark-light uppercase tracking-wide font-medium">è©¦åˆæ•°</span>
          </div>
          <div class="bg-surface border border-tertiary rounded-lg p-4 text-center">
            <span class="block text-3xl font-bold text-accent mb-1">{detailedStats.season_overview.total_players}</span>
            <span class="text-sm text-dark-light uppercase tracking-wide font-medium">é¸æ‰‹æ•°</span>
          </div>
          <div class="bg-surface border border-tertiary rounded-lg p-4 text-center">
            <span class="block text-3xl font-bold text-accent mb-1">{detailedStats.season_overview.unique_champions_played}</span>
            <span class="text-sm text-dark-light uppercase tracking-wide font-medium">ä½¿ç”¨ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³</span>
          </div>
          <div class="bg-surface border border-tertiary rounded-lg p-4 text-center">
            <span class="block text-3xl font-bold text-accent mb-1">{detailedStats.season_overview.unique_champions_banned}</span>
            <span class="text-sm text-dark-light uppercase tracking-wide font-medium">BANãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Statistics Navigation -->
    <section class="py-8 bg-primary">
      <div class="max-w-6xl mx-auto px-5">
        <nav class="flex flex-wrap justify-center gap-4" role="tablist">
          <button class="stats-tab-btn active" data-tab="players" role="tab" aria-selected="true">
            <span class="block text-lg font-semibold mb-1">ğŸ‘¤ é¸æ‰‹çµ±è¨ˆ</span>
            <span class="text-sm opacity-80">å€‹äººæˆç¸¾ãƒ»KDA</span>
          </button>
          <button class="stats-tab-btn" data-tab="teams" role="tab" aria-selected="false">
            <span class="block text-lg font-semibold mb-1">ğŸ† ãƒãƒ¼ãƒ åˆ†æ</span>
            <span class="text-sm opacity-80">ãƒãƒ¼ãƒ æˆç¸¾ãƒ»æ¯”è¼ƒ</span>
          </button>
          <button class="stats-tab-btn" data-tab="champions" role="tab" aria-selected="false">
            <span class="block text-lg font-semibold mb-1">ğŸ¯ ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³</span>
            <span class="text-sm opacity-80">ãƒ”ãƒƒã‚¯ãƒ»ãƒãƒ³ãƒ»å‹ç‡</span>
          </button>
          <button class="stats-tab-btn" data-tab="matches" role="tab" aria-selected="false">
            <span class="block text-lg font-semibold mb-1">ğŸ“Š è©¦åˆåˆ†æ</span>
            <span class="text-sm opacity-80">è©³ç´°ãƒ»æ´å¯Ÿ</span>
          </button>
        </nav>
      </div>
    </section>

    <!-- Statistics Content -->
    <div class="max-w-7xl mx-auto px-5 py-12">
      
      <!-- Player Statistics Tab -->
      <div id="players-tab" class="stats-tab-content active" role="tabpanel">
        <header class="text-center mb-12">
          <h2 class="text-3xl text-dark mb-4 relative after:absolute after:bottom-0 after:left-1/2 after:-translate-x-1/2 after:w-20 after:h-0.5 after:bg-accent after:-bottom-2">é¸æ‰‹çµ±è¨ˆ</h2>
          <p class="text-lg text-dark-light max-w-2xl mx-auto">
            å…¨é¸æ‰‹ã®è©³ç´°æˆç¸¾ãƒ‡ãƒ¼ã‚¿ãƒ»KDAãƒ»ãƒ€ãƒ¡ãƒ¼ã‚¸ãƒ»ä½¿ç”¨ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³åˆ†æ
          </p>
        </header>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
          <div>
            <h3 class="text-2xl font-semibold text-dark mb-6 flex items-center gap-2">
              <span class="text-red-400">âš”ï¸</span> COREéƒ¨é–€
            </h3>
            <PlayerStatsTable 
              players={detailedStats.player_statistics} 
              division="CORE"
              limit={10}
            />
          </div>
          
          <div>
            <h3 class="text-2xl font-semibold text-dark mb-6 flex items-center gap-2">
              <span class="text-purple-400">ğŸŒŸ</span> NEXTéƒ¨é–€
            </h3>
            <PlayerStatsTable 
              players={detailedStats.player_statistics} 
              division="NEXT"
              limit={10}
            />
          </div>
        </div>
      </div>

      <!-- Team Performance Tab -->
      <div id="teams-tab" class="stats-tab-content" role="tabpanel">
        <header class="text-center mb-12">
          <h2 class="text-3xl text-dark mb-4 relative after:absolute after:bottom-0 after:left-1/2 after:-translate-x-1/2 after:w-20 after:h-0.5 after:bg-accent after:-bottom-2">ãƒãƒ¼ãƒ åˆ†æ</h2>
          <p class="text-lg text-dark-light max-w-2xl mx-auto">
            å„ãƒãƒ¼ãƒ ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™ãƒ»ãƒ­ãƒ¼ãƒ«åˆ¥åˆ†æãƒ»å¯¾æˆ¦æˆç¸¾
          </p>
        </header>
        
        <TeamPerformanceChart 
          teams={detailedStats.team_performance}
        />
      </div>

      <!-- Champion Analytics Tab -->
      <div id="champions-tab" class="stats-tab-content" role="tabpanel">
        <header class="text-center mb-12">
          <h2 class="text-3xl text-dark mb-4 relative after:absolute after:bottom-0 after:left-1/2 after:-translate-x-1/2 after:w-20 after:h-0.5 after:bg-accent after:-bottom-2">ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³åˆ†æ</h2>
          <p class="text-lg text-dark-light max-w-2xl mx-auto">
            ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³ä½¿ç”¨ç‡ãƒ»å‹ç‡ãƒ»ãƒ¡ã‚¿åˆ†æãƒ»ãƒ­ãƒ¼ãƒ«åˆ¥ãƒ‡ãƒ¼ã‚¿
          </p>
        </header>
        
        <ChampionAnalytics 
          champions={detailedStats.champion_analytics}
          metaAnalysis={detailedStats.meta_analysis}
        />
      </div>

      <!-- Match Insights Tab -->
      <div id="matches-tab" class="stats-tab-content" role="tabpanel">
        <header class="text-center mb-12">
          <h2 class="text-3xl text-dark mb-4 relative after:absolute after:bottom-0 after:left-1/2 after:-translate-x-1/2 after:w-20 after:h-0.5 after:bg-accent after:-bottom-2">è©¦åˆåˆ†æ</h2>
          <p class="text-lg text-dark-light max-w-2xl mx-auto">
            å„è©¦åˆã®è©³ç´°åˆ†æãƒ»ã‚­ãƒ¼ãƒ¢ãƒ¼ãƒ¡ãƒ³ãƒˆãƒ»ãƒ‰ãƒ©ãƒ•ãƒˆæˆ¦ç•¥
          </p>
        </header>
        
        <MatchInsightsPanel 
          matches={detailedStats.matches}
        />
      </div>
    </div>
  </main>

  <Footer />
</Layout>

<style>
  .stats-tab-btn {
    @apply bg-surface border border-tertiary rounded-lg p-4 text-center transition-all duration-300 hover:border-accent-light hover:shadow-sm cursor-pointer min-w-[180px];
  }
  
  .stats-tab-btn.active {
    @apply border-accent bg-accent/10 transform scale-105;
  }
  
  .stats-tab-content {
    @apply hidden;
  }
  
  .stats-tab-content.active {
    @apply block;
  }
  
  /* Mobile responsive */
  @media (max-width: 768px) {
    .stats-tab-btn {
      @apply min-w-[140px] p-3;
    }
    
    .stats-tab-btn span:first-child {
      @apply text-base;
    }
    
    .stats-tab-btn span:last-child {
      @apply text-xs;
    }
  }
</style>

<script>
  // Tab switching functionality
  document.addEventListener('DOMContentLoaded', () => {
    const tabButtons = document.querySelectorAll('.stats-tab-btn');
    const tabContents = document.querySelectorAll('.stats-tab-content');
    
    tabButtons.forEach(button => {
      button.addEventListener('click', () => {
        const targetTab = button.getAttribute('data-tab') + '-tab';
        
        // Remove active state from all buttons and contents
        tabButtons.forEach(btn => {
          btn.classList.remove('active');
          btn.setAttribute('aria-selected', 'false');
        });
        tabContents.forEach(content => {
          content.classList.remove('active');
        });
        
        // Add active state to clicked button and corresponding content
        button.classList.add('active');
        button.setAttribute('aria-selected', 'true');
        
        const targetContent = document.getElementById(targetTab);
        if (targetContent) {
          targetContent.classList.add('active');
        }
      });
    });
    
    // Keyboard navigation for accessibility
    tabButtons.forEach((button, index) => {
      button.addEventListener('keydown', (e: KeyboardEvent) => {
        let targetIndex = index;
        
        if (e.key === 'ArrowRight') {
          targetIndex = (index + 1) % tabButtons.length;
        } else if (e.key === 'ArrowLeft') {
          targetIndex = (index - 1 + tabButtons.length) % tabButtons.length;
        } else {
          return;
        }
        
        e.preventDefault();
        const targetButton = tabButtons[targetIndex] as HTMLButtonElement;
        if (targetButton) {
          targetButton.focus();
          targetButton.click();
        }
      });
    });
  });
</script>